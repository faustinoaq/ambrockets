!function(e){function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}var t={};n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="/dist",n(n.s=0)}([function(e,n,t){"use strict";var o=t(1),i=function(e){return e&&e.__esModule?e:{default:e}}(o),c=new i.default.Socket("/chat"),s=document.getElementById("messages"),a=document.getElementById("message");c.connect().then(function(){var e=c.channel("chat_room:hello");e.join(),e.on("message_new",function(e){var n=document.createElement("p");n.innerText=e.message,n.innerHTML="<b>"+e.user.trim()+": </b>"+n.innerHTML,s.append(n),s.scrollTop=s.scrollHeight}),$("#form-message").on("submit",function(n){n.preventDefault(),e.push("message_new",{user:$(".user").text(),message:a.value}),a.value=""})})},function(e,n,t){"use strict";function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),c={join:"join",leave:"leave",message:"message"},s=function(){return(new Date).getTime()},a=function(e){return(s()-e)/1e3},r=n.Channel=function(){function e(n,t){o(this,e),this.topic=n,this.socket=t,this.onMessageHandlers=[]}return i(e,[{key:"join",value:function(){this.socket.ws.send(JSON.stringify({event:c.join,topic:this.topic}))}},{key:"leave",value:function(){this.socket.ws.send(JSON.stringify({event:c.leave,topic:this.topic}))}},{key:"handleMessage",value:function(e){this.onMessageHandlers.forEach(function(n){n.subject===e.subject&&n.callback(e.payload)})}},{key:"on",value:function(e,n){this.onMessageHandlers.push({subject:e,callback:n})}},{key:"push",value:function(e,n){this.socket.ws.send(JSON.stringify({event:c.message,topic:this.topic,subject:e,payload:n}))}}]),e}(),u=n.Socket=function(){function e(n){o(this,e),this.endpoint=n,this.ws=null,this.channels=[],this.lastPing=s(),this.reconnectTries=0,this.attemptReconnect=!0}return i(e,[{key:"_connectionIsStale",value:function(){return a(this.lastPing)>100}},{key:"_reconnect",value:function(){var e=this;clearTimeout(this.reconnectTimeout),this.reconnectTimeout=setTimeout(function(){e.reconnectTries++,e.connect(e.params).then(function(){e.channel("chat_room:hello").join()}),e._reconnect()},this._reconnectInterval())}},{key:"_reconnectInterval",value:function(){return[1e3,2e3,5e3,1e4][this.reconnectTries]||1e4}},{key:"_poll",value:function(){var e=this;this.pollingTimeout=setTimeout(function(){e._connectionIsStale()?e._reconnect():e._poll()},1e4)}},{key:"_startPolling",value:function(){clearTimeout(this.pollingTimeout),this._poll()}},{key:"_handlePing",value:function(){this.lastPing=s()}},{key:"_reset",value:function(){clearTimeout(this.reconnectTimeout),this.reconnectTries=0,this.attemptReconnect=!0,this._startPolling()}},{key:"connect",value:function(e){var n=this;this.params=e;var t={location:window.location.hostname,port:window.location.port,protocol:"https:"===window.location.protocol?"wss:":"ws:"};return e&&Object.assign(t,e),t.port&&(t.location+=":"+t.port),new Promise(function(e,o){n.ws=new WebSocket(t.protocol+"//"+t.location+n.endpoint),n.ws.onmessage=function(e){n.handleMessage(e)},n.ws.onclose=function(){n.attemptReconnect&&n._reconnect()},n.ws.onopen=function(){n._reset(),e()}})}},{key:"disconnect",value:function(){this.attemptReconnect=!1,clearTimeout(this.pollingTimeout),clearTimeout(this.reconnectTimeout),this.ws.close()}},{key:"channel",value:function(e){var n=new r(e,this);return this.channels.push(n),n}},{key:"handleMessage",value:function(e){if("ping"===e.data)return this._handlePing();var n=JSON.parse(e.data);this.channels.forEach(function(e){e.topic===n.topic&&e.handleMessage(n)})}}]),e}();e.exports={Socket:u}}]);